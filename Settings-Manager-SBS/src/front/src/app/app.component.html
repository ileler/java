<div class="ui-helper-clearfix" style="width: 100%">
  <button *ngIf="!isLogin" class="ui-button-secondary" type="button" pButton style="margin-bottom: 10px; float: right" (click)="showDialogToLogin()" label="Login"></button>
  <button *ngIf="isLogin" class="ui-button-danger" type="button" pButton style="margin-bottom: 10px; float: right" (click)="toLogout()" label="Logout"></button>
  <button *ngIf="isLogin && username === 'super'" class="ui-button-info" type="button" pButton style="margin-bottom: 10px; float: right" (click)="showDialogToAddUser();" label="Add"></button>
  <button *ngIf="isLogin" class="ui-button-success" type="button" pButton style="margin-bottom: 10px; float: right" (click)="showDialogToLogin(); login.username = username;" [label]="username"></button>
</div>
<p-dialog header="{{username ? 'User' : 'Login'}} Details" [(visible)]="displayLoginDialog" [responsive]="true" showEffect="fade" [modal]="true">
  <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="login">
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="username">USERNAME</label></div>
      <div class="ui-grid-col-8"><input pInputText id="username" [(ngModel)]="login.username" [disabled]="username"/></div>
    </div>
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="password">PASSWORD</label></div>
      <div class="ui-grid-col-8"><input type="password" pInputText id="password" [(ngModel)]="login.password" /></div>
    </div>
  </div>
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button type="button" pButton icon="fa-close" (click)="displayLoginDialog = false;" label="Cancel"></button>
      <button type="button" pButton icon="fa-check" (click)="username ? modify() : toLogin()" label="Enter"></button>
    </div>
  </p-footer>
</p-dialog>
<p-dialog header="User Details" [(visible)]="displayAddUserDialog" [responsive]="true" showEffect="fade" [modal]="true">
  <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="newUser">
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="newUser.username">USERNAME</label></div>
      <div class="ui-grid-col-8"><input pInputText id="newUser.username" [(ngModel)]="newUser.username"/></div>
    </div>
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="newUser.password">PASSWORD</label></div>
      <div class="ui-grid-col-8"><input type="password" pInputText id="newUser.password" [(ngModel)]="newUser.password" /></div>
    </div>
  </div>
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button type="button" pButton icon="fa-close" (click)="displayAddUserDialog = false;" label="Cancel"></button>
      <button type="button" pButton icon="fa-check" (click)="addUser()" label="Enter"></button>
    </div>
  </p-footer>
</p-dialog>

<p-dataTable [value]="envs" selectionMode="single" [(selection)]="selectedEnv" (onRowSelect)="onRowSelectEnv($event)" [resizableColumns]="true" [responsive]="true">
  <p-header>
    Envs
    <div class="ui-helper-clearfix" style="width:100%"><button type="button" pButton icon="fa-plus" style="float:left" (click)="showDialogToAddEnv()" label="Add" [disabled]="!isLogin"></button></div>
  </p-header>
  <p-column field="name" header="NAME"></p-column>
  <p-column field="path" header="PATH"></p-column>
  <p-column field="template" header="TEMPLATE"></p-column>
</p-dataTable>
<p-dialog header="Env Details" [(visible)]="displayEnvDialog" [responsive]="true" showEffect="fade" [modal]="true">
  <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="env">
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="env-name">NAME</label></div>
      <div class="ui-grid-col-8"><input pInputText id="env-name" [(ngModel)]="env.name" [disabled]="!newEnv"/></div>
    </div>
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="env-path">PATH</label></div>
      <div class="ui-grid-col-8"><input pInputText id="env-path" [(ngModel)]="env.path" /></div>
    </div>
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="env-template">TEMPLATE</label></div>
      <div class="ui-grid-col-8"><textarea pInputTextarea id="env-template" [(ngModel)]="env.template"></textarea></div>
    </div>
  </div>
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button type="button" pButton icon="fa-close" (click)="deleteEnv()" label="Delete" [disabled]="!isLogin"></button>
      <button type="button" pButton icon="fa-check" (click)="saveEnv()" label="Save" [disabled]="!isLogin"></button>
    </div>
  </p-footer>
</p-dialog>

<hr />

<p-selectButton [options]="allEnv" [(ngModel)]="currentEnv" (onChange)="changeCurrentEnv()"></p-selectButton>

<hr />

<p-dataTable [value]="servers" selectionMode="single" [(selection)]="selectedServer" (onRowSelect)="onRowSelectServer($event)" [responsive]="true">
  <p-header>
    Servers
    <div class="ui-helper-clearfix" style="width:100%">
      <button type="button" pButton icon="fa-plus" style="float:left" (click)="showDialogToAddServer()" label="Add" [disabled]="!isLogin || (!envs  || envs.length < 1)"></button>
    </div>
  </p-header>
  <p-column field="id" header="ID"></p-column>
  <p-column field="host" header="HOST"></p-column>
  <p-column field="port" header="PORT"></p-column>
  <p-column field="shome" header="SHOME"></p-column>
  <p-column field="username" header="USERNAME"></p-column>
  <p-column field="password" header="PASSWORD" [hidden]="!isLogin"></p-column>
  <!--<p-column field="configuration" header="CONFIGURATION"></p-column>-->
  <p-column header="STATUS">
    <ng-template let-obj="rowData" let-i="rowIndex" pTemplate="body">
      <button *ngIf="obj.connectMessage" type="button" pButton (click)="showServerMsg(obj)" label="error msg" class="ui-button-danger"></button>
      <button *ngIf="obj.connectMessage === undefined" type="button" pButton label="checking" class="ui-button-success"></button>
      <button *ngIf="checkServiceNo(obj.id) && obj.connectMessage !== undefined && !obj.connectMessage" type="button" pButton (click)="showServiceDialog(obj.id)" label="ok" class="ui-button-success"></button>
      <button *ngIf="!checkServiceNo(obj.id) && obj.connectMessage !== undefined && !obj.connectMessage" type="button" pButton (click)="showServiceDialog(obj.id)" label="ok" class="ui-button-warning"></button>
      <!--<button *ngIf="!obj.connectMessage" type="button" pButton (click)="showServerLoginLogs(obj)" label="login logs" class="ui-button-info"></button>-->
      <!--<button *ngIf="!obj.connectMessage" type="button" pButton (click)="showServerOperLogs(obj)" label="oper logs" class="ui-button-info"></button>-->
    </ng-template>
  </p-column>
</p-dataTable>
<p-dialog header="Server Details" [(visible)]="displayServerDialog" [responsive]="true" showEffect="fade" [modal]="true">
  <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="server">
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="server-id">ID</label></div>
      <div class="ui-grid-col-8"><input pInputText id="server-id" [(ngModel)]="server.id" [disabled]="!newServer"/></div>
    </div>
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="server-host">HOST</label></div>
      <div class="ui-grid-col-8"><input pInputText id="server-host" [(ngModel)]="server.host" /></div>
    </div>
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="server-port">PORT</label></div>
      <div class="ui-grid-col-8"><input pInputText id="server-port" [(ngModel)]="server.port" /></div>
    </div>
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="server-shome">SHOME</label></div>
      <div class="ui-grid-col-8"><input pInputText id="server-shome" [(ngModel)]="server.shome" /></div>
    </div>
    <div class="ui-grid-row">
      <div class="ui-grid-col-4"><label for="server-username">USERNAME</label></div>
      <div class="ui-grid-col-8"><input pInputText id="server-username" [(ngModel)]="server.username" /></div>
    </div>
    <div class="ui-grid-row" *ngIf="isLogin">
      <div class="ui-grid-col-4"><label for="server-password">PASSWORD</label></div>
      <div class="ui-grid-col-8"><input pInputText id="server-password" [(ngModel)]="server.password" /></div>
    </div>
    <!--<div class="ui-grid-row">-->
      <!--<div class="ui-grid-col-4"><label for="server-configuration">CONFIGURATION</label></div>-->
      <!--<div class="ui-grid-col-8"><input pInputText id="server-configuration" [(ngModel)]="server.configuration" /></div>-->
    <!--</div>-->
  </div>
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button type="button" pButton icon="fa-close" (click)="deleteServer()" label="Delete" [disabled]="!isLogin"></button>
      <button type="button" pButton icon="fa-check" (click)="saveServer()" label="Save" [disabled]="!isLogin"></button>
    </div>
  </p-footer>
</p-dialog>
<p-dialog header="Services Details" [(visible)]="displayServicesDialog" [responsive]="true" showEffect="fade" [modal]="true">
  <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="services && currentEnv && currentEnv.name && serviceSID">
    <p-dataTable [value]="services[currentEnv.name + '-' + serviceSID]" [resizableColumns]="true" [responsive]="true">
      <p-header>
        Services{{checkServiceNo(serviceSID) ? '' : '[The number of services and instances is inconsistent]'}}
      </p-header>
      <p-column field="pid" header="PID" sortable="true" [style]="{'width':'100px'}"></p-column>
      <p-column field="detail" header="DETAIL" sortable="true">
        <ng-template let-col let-row="rowData" pTemplate="body">
          <textarea pInputTextarea autoResize="autoResize" value="{{row[col.field]}}"></textarea>
        </ng-template>
      </p-column>
      <p-column header="OPERATION" [style]="{'width':'100px'}">
        <ng-template let-obj="rowData" let-i="rowIndex" pTemplate="body">
          <button type="button" pButton (click)="killService(obj.pid)" label="kill" class="ui-button-danger" [disabled]="!isLogin"></button>
        </ng-template>
      </p-column>
    </p-dataTable>
  </div>
</p-dialog>

<hr />

<p-selectButton [options]="allServer" [(ngModel)]="currentServer" (onChange)="serverChange()" #psb></p-selectButton>

<hr />

<p-dataTable [value]="profiles" selectionMode="single" [(selection)]="selectedProfile" (onRowSelect)="onRowSelectProfile($event)" [sortMode]="multiple" [resizableColumns]="true" [paginator]="true" rows="15" [responsive]="true" [globalFilter]="gb" #pdt>
    <p-header>
      Profiles
      <div class="ui-helper-clearfix" style="width:100%">
        <button type="button" pButton icon="fa-plus" style="float:left" (click)="showDialogToAddProfile()" label="Add" [disabled]="!isLogin || (!servers  || servers.length < 1)"></button>
      </div>
      <input #gb type="text" placeholder="Global search">
    </p-header>
    <p-column field="id" header="ID" sortable="true"></p-column>
    <p-column field="sid" header="SID" sortable="true"></p-column>
    <p-column field="dir" header="DIR" sortable="true"></p-column>
    <p-column field="port" header="PORT" sortable="true"></p-column>
    <p-column field="dPort" header="DPORT" sortable="true"></p-column>
    <p-column field="arg" header="ARG"></p-column>
</p-dataTable>
<p-dialog header="Profile Details" [(visible)]="displayProfileDialog" [responsive]="true" showEffect="fade" [modal]="true" width="350">
    <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="profile">
        <div class="ui-grid-row">
            <div class="ui-grid-col-4"><label for="profile-id">ID</label></div>
            <div class="ui-grid-col-8"><input pInputText id="profile-id" [(ngModel)]="profile.id" [disabled]="!newProfile"/></div>
        </div>
        <div class="ui-grid-row">
            <div class="ui-grid-col-4"><label for="profile-sid">SID</label></div>
            <!--<div class="ui-grid-col-8"><input pInputText id="profile-sid" [(ngModel)]="profile.sid" /></div>-->
            <div class="ui-grid-col-8"><p-dropdown id="profile-sid" [options]="servers" [style]="{'width':'100%'}" optionLabel="id" [(ngModel)]="profile.sid"></p-dropdown></div>
        </div>
        <div class="ui-grid-row">
            <div class="ui-grid-col-4"><label for="profile-dir">DIR</label></div>
            <div class="ui-grid-col-8"><input pInputText id="profile-dir" [(ngModel)]="profile.dir" /></div>
        </div>
        <div class="ui-grid-row">
            <div class="ui-grid-col-4"><label for="profile-port">PORT</label></div>
            <div class="ui-grid-col-8"><input pInputText id="profile-port" [(ngModel)]="profile.port" /></div>
        </div>
        <div class="ui-grid-row">
            <div class="ui-grid-col-4"><label for="profile-dport">DPORT</label></div>
            <div class="ui-grid-col-8"><input pInputText id="profile-dport" [(ngModel)]="profile.dPort" /></div>
        </div>
        <div class="ui-grid-row">
            <div class="ui-grid-col-4"><label for="profile-arg">ARG</label></div>
            <div class="ui-grid-col-8"><input pInputText id="profile-arg" [(ngModel)]="profile.arg" /></div>
        </div>
    </div>
    <p-footer>
        <div class="ui-dialog-buttonpane ui-helper-clearfix">
            <button type="button" pButton icon="fa-close" (click)="deleteProfile()" label="Delete" [disabled]="!isLogin"></button>
            <button type="button" pButton icon="fa-check" (click)="saveProfile()" label="Save" [disabled]="!isLogin"></button>
        </div>
    </p-footer>
</p-dialog>
